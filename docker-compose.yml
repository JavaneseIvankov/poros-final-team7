services:
   db:
      image: postgres:latest
      volumes:
         - db_data:/var/lib/postgresql/data
      healthcheck:
         test: ['CMD-SHELL', 'pg_isready -U ${DB_USER}']
         interval: 10s
         timeout: 5s
         retries: 5

   app:
      image: javaneseivankov/poros-final-team7:latest
      depends_on:
         db:
            condition: service_healthy
      volumes:
         - app_data:/app/data
      healthcheck:
         test: ['CMD-SHELL', 'curl -f http://localhost:8080/health || exit 1']
         interval: 30s
         timeout: 10s
         retries: 3

volumes:
   db_data:
   app_data:
